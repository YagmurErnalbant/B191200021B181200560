<!DOCTYPE html>
<html>
<head>
	<title>User Information Form</title>
	<style>
		body {
			background-image: url('https://listelist.com/wp-content/uploads/2020/04/iStock-10245774041.jpg');
			background-size: cover;
			color: rgb(0, 0, 0);
			font-family: Arial, sans-serif;
			text-align: center;
		}
		h1 {
			font-size: 3rem;
			margin-top: 5%;
			margin-bottom: 2%;
		}
		form {
			margin-top: 2%;
			display: inline-block;
			padding: 2%;
			background-color: rgba(255, 255, 255, 0.3);
			border-radius: 10px;
		}
		label {
			font-size: 1.2rem;
			font-weight: bold;
			display: block;
			margin-top: 2%;
			margin-bottom: 1%;
		}
		select, input[type="file"] {
			font-size: 1.2rem;
			padding: 1%;
			margin-bottom: 2%;
			border-radius: 5px;
			border: none;
		}
		input[type="submit"] {
			background-color: #2ecc71;
			color: rgb(255, 255, 255);
			padding: 1% 2%;
			font-size: 1.2rem;
			border-radius: 5px;
			border: none;
			cursor: pointer;
			margin-top: 3%;
		}
		input[type="submit"]:hover {
			background-color: #27ae60;
		}
		#previewImage {
			max-width: 300px;
			max-height: 300px;
			margin-bottom: 2%;
		}
	</style>
	<link rel="stylesheet" href="https://unpkg.com/cropperjs/dist/cropper.css">
</head>
<body>
	<h1>User Information Form</h1>
	<form method="post" action="/save_user" enctype="multipart/form-data" onsubmit="return validateForm()">
		<label for="gender">Gender:</label>
		<select id="gender" name="gender">
			<option value="female">Female</option>
			<option value="male">Male</option>
		</select>
		
		<label for="age">Age Scope:</label>
		<select id="age" name="age">
			<option value="18-30">18-30</option>
			<option value="30-50">31-50</option>
			<option value="over 50">Over 50</option>
		</select>

		<label for="image">Upload an Image:</label>
		<input type="file" id="image" name="image">

		<input type="hidden" id="croppedImage" name="croppedImage">
		<input type="hidden" id="cropX" name="cropX">
		<input type="hidden" id="cropY" name="cropY">
		<input type="hidden" id="cropWidth" name="cropWidth">
		<input type="hidden" id="cropHeight" name="cropHeight">

		<img id="previewImage" src="" alt="Preview Image">

		<input type="submit" value="Submit">
	</form>

	<script src="https://unpkg.com/cropperjs/dist/cropper.js"></script>
	<script>
		document.getElementById('image').addEventListener('change', function(event) {
			var input = event.target;
			var reader = new FileReader();

			reader.onload = function(){
				var img = document.getElementById('previewImage');
				img.src = reader.result;

				// Initialize Cropper.js
				var cropper = new Cropper(img, {
					aspectRatio: 1, // Set the aspect ratio you desire
					viewMode: 1, // Set the cropping area mode (0: free, 1: restricted, 2: square)
					// Add more options if needed
					crop: function(event) {
						document.getElementById('cropX').value = event.detail.x;
						document.getElementById('cropY').value = event.detail.y;
						document.getElementById('cropWidth').value = event.detail.width;
						document.getElementById('cropHeight').value = event.detail.height;
					}
				});
			};

			reader.readAsDataURL(input.files[0]);
		});

		function validateForm() {
			var cropper = document.getElementById('previewImage').cropper;
			if (cropper) {
				// Get the cropped canvas data
				var croppedCanvas = cropper.getCroppedCanvas();
				if (croppedCanvas) {
					// Convert the cropped canvas to a base64 encoded URL
					var croppedImage = croppedCanvas.toDataURL('image/jpeg');

					// Set the cropped image data in the hidden input field
					document.getElementById('croppedImage').value = croppedImage;

					// Return true to submit the form
					return true;
				} else {
					// No crop data available, show an error message or handle it as desired
					alert('Please crop the image before submitting the form.');
					return false;
				}
			} else {
				// Cropper instance not found, show an error message or handle it as desired
				alert('Image is not selected or not loaded properly.');
				return false;
			}
		}
	</script>
</body>
</html>
